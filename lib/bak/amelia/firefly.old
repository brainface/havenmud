#include <lib.h>
inherit LIB_NPC;

int Tamed = 0;
int Life = 1000;
string Creator;
void destme();
int SetLife(int mrow);
string SetCreator(string who);
int CheckCreator();
int AddTame();
int FollowSomeone(string str);
int Dance(string str);
int StopFollow(string str);
string GetCreator();
int GetTamed();


static void create() {
   npc::create();
   SetKeyName("firefly");
   SetShort("a shining firefly");
   SetId( ({ "firefly" }) );
   SetAdjectives( ({ "shining" }) );
   SetLong("A pair of shimmering wings hang off the glowing body of this small "
	"firefly.  Little sparks of light fall off her wings whenever a breeze "
	"disturbs them.");
   SetRace("insect");
   SetClass("animal");
   SetLevel(1);
   SetGender("female");
   SetAction(3, ({
                   "!emote buzzes around.",
                   "!emote flickers her light.",
                   "!emote does some flips in the air.",
                }) );
   SetRadiantLight(10);
   set_heart_beat(1);
}

void heart_beat() {
     Life--;
     if (!Life) destme();
}

void destme() {
    if (environment(this_object())) {
        message("system","The firefly flits away into the wilderness.",
            environment(this_object()) );
    }
    eventDestruct();
}

int SetLife(int mrow) {
    return Life = mrow;
}

string SetCreator(string who) {
    return Creator = who;
}

int CheckCreator() {
    return (Creator == this_player()->GetKeyName());
}

string GetCreator() {
    return Creator;
}

int AddTame() {
    AddCommandResponse("follow",(:FollowSomeone:));
    AddCommandResponse("stop",(:StopFollow:));
    AddCommandResponse("dance",(:Dance:));
    Tamed = 1;
    return 1;
}

int GetTamed() {
    return Tamed;
}

int FollowSomeone(string str) {
    if(!CheckCreator()) {
       send_messages( ({ "look" }), "$agent_name $agent_verb at $target_name "
		"quizzically.", this_object(), this_player(),
		environment(this_object()));
       return 1;
    }
    eventForce("follow " + Creator);
    this_player()->eventForce("lead " + GetKeyName());
    send_messages( ({ "buzz" }),"$agent_name $agent_verb over to $target_possessive_noun "
		"shoulder.",this_object(),this_player(),environment(this_object()));
    return 1;
}

int Dance(string str) {
    if(!CheckCreator()) {
       send_messages( ({ "look" }), "$agent_name $agent_verb at $target_name "
		"quizzically.", this_object(), this_player(),
		environment(this_object()));
       return 1;
    }
    send_messages( ({ "dance","circle" }), "$agent_name $agent_verb "
	"with twirls and swirls, trying to impress $target_name.  Shimmering "
	"with light, $agent_nominative $agent_verb $target_possessive_noun head tightly, "
	"eventually crashing into $target_possessive nose.",this_object(),
	this_player(),environment(this_object()));
    return 1;
}

int StopFollow(string str) {
    if(!CheckCreator()) {
       send_messages( ({ "look" }), "$agent_name $agent_verb at $target_name "
		"quizzically.", this_object(), this_player(),
		environment(this_object()));
       return 1;
    }
    send_messages( ({ "buzz" }),"$agent_name $agent_verb away from $target_possessive_noun "
		"shoulder.",this_object(),this_player(),environment(this_player()));
    eventForce("follow "+ GetKeyName());
    return 1;
}